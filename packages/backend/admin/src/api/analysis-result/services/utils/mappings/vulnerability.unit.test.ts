import {
  mapVulnerabilityAnalysisResult,
  mapVulnerabilitySingleAreaAnalysisResult,
} from "./vulnerability";
import { Feature, Polygon } from "geojson";

export const testAnalysisResult = {
  "0": {
    extended: {
      collisionIntegral: 0.016456241245991564,
      fluxIntegral: 0.19270700796788862,
      proportionAtRotorHeight: 0.18298224999999885,
    },
    single: {
      upwindCollisionRisk: {
        total: 0.11018389584870522,
        results: [
          { pcollision: 1 },
          {
            alpha: 3.1946737667900442,
            colllength: 14.448347313677731,
            pcollision: 0.713851151861548,
          },
          {
            alpha: 1.5973368833950221,
            colllength: 8.07700443379467,
            pcollision: 0.39906148388313595,
          },
          {
            alpha: 1.0648912555966814,
            colllength: 6.159410379927404,
            pcollision: 0.30431869466044487,
          },
          {
            alpha: 0.7986684416975111,
            colllength: 5.206272105914116,
            pcollision: 0.25722688270326666,
          },
          {
            alpha: 0.638934753358009,
            colllength: 4.521741769265459,
            pcollision: 0.2234062138965148,
          },
          {
            alpha: 0.5324456277983407,
            colllength: 3.9697468634839623,
            pcollision: 0.19613373831442504,
          },
          {
            alpha: 0.4563819666842921,
            colllength: 3.4898850515178923,
            pcollision: 0.17242515076669432,
          },
          {
            alpha: 0.39933422084875553,
            colllength: 3.086508871358544,
            pcollision: 0.152495497596766,
          },
          {
            alpha: 0.3549637518655605,
            colllength: 2.806484175034533,
            pcollision: 0.13866028532779315,
          },
          {
            alpha: 0.3194673766790045,
            colllength: 2.5715681361765075,
            pcollision: 0.12705376166879978,
          },
          {
            alpha: 0.29042488789000404,
            colllength: 2.369458393657382,
            pcollision: 0.11706810245342798,
          },
          {
            alpha: 0.26622281389917035,
            colllength: 2.170231013801777,
            pcollision: 0.10722485246056211,
          },
          {
            alpha: 0.24574413590692648,
            colllength: 1.9915958938019742,
            pcollision: 0.09839900661076949,
          },
          {
            alpha: 0.22819098334214605,
            colllength: 1.8291404065460146,
            pcollision: 0.09037254973053432,
          },
          {
            alpha: 0.21297825111933633,
            colllength: 1.699185769517416,
            pcollision: 0.08395186608287629,
          },
          {
            alpha: 0.19966711042437776,
            colllength: 1.559649445850438,
            pcollision: 0.07705777894517975,
          },
          {
            alpha: 0.18792198628176732,
            colllength: 1.4659141053547535,
            pcollision: 0.07242658623294237,
          },
          {
            alpha: 0.17748187593278025,
            colllength: 1.3234100098012167,
            pcollision: 0.06538587004946723,
          },
          {
            alpha: 0.16814072456789708,
            colllength: 1.2056113107531101,
            pcollision: 0.059565776222979754,
          },
          {
            alpha: 0.15973368833950224,
            colllength: 0.78,
            pcollision: 0.03853754940711463,
          },
        ],
      },
      downwindCollisionRisk: {
        total: 0.05774980486280009,
        results: [
          { pcollision: 1 },
          {
            alpha: 3.1946737667900442,
            colllength: 12.857490171050577,
            pcollision: 0.6352514906645542,
          },
          {
            alpha: 1.5973368833950221,
            colllength: 6.355391909581724,
            pcollision: 0.3140015765603619,
          },
          {
            alpha: 1.0648912555966814,
            colllength: 4.241664783335765,
            pcollision: 0.2095684181490003,
          },
          {
            alpha: 0.7986684416975111,
            colllength: 3.11418600054142,
            pcollision: 0.15386294469078163,
          },
          {
            alpha: 0.638934753358009,
            colllength: 2.3424854095022343,
            pcollision: 0.11573544513350961,
          },
          {
            alpha: 0.5324456277983407,
            colllength: 1.834075630916003,
            pcollision: 0.09061638492667999,
          },
          {
            alpha: 0.4563819666842921,
            colllength: 1.4849692005357256,
            pcollision: 0.07336804350472953,
          },
          {
            alpha: 0.39933422084875553,
            colllength: 1.2341409655598023,
            pcollision: 0.06097534414821159,
          },
          {
            alpha: 0.3549637518655605,
            colllength: 1.0630790872239528,
            pcollision: 0.05252367031738898,
          },
          {
            alpha: 0.3194673766790045,
            colllength: 0.9371258663540895,
            pcollision: 0.046300685096545925,
          },
          {
            alpha: 0.29042488789000404,
            colllength: 0.8439789418231246,
            pcollision: 0.041698564319324345,
          },
          {
            alpha: 0.26622281389917035,
            colllength: 0.7844930564466864,
            pcollision: 0.03875953836199044,
          },
          {
            alpha: 0.24574413590692648,
            colllength: 0.8323727948606962,
            pcollision: 0.04112513808600278,
          },
          {
            alpha: 0.22819098334214605,
            colllength: 0.864072900530862,
            pcollision: 0.04269134884045762,
          },
          {
            alpha: 0.21297825111933633,
            colllength: 0.8850647195712997,
            pcollision: 0.043728494049965407,
          },
          {
            alpha: 0.19966711042437776,
            colllength: 0.8938456616524841,
            pcollision: 0.044162335061881636,
          },
          {
            alpha: 0.18792198628176732,
            colllength: 0.9004107477576393,
            pcollision: 0.04448669702359879,
          },
          {
            alpha: 0.17748187593278025,
            colllength: 0.8903668981277507,
            pcollision: 0.04399045939366358,
          },
          {
            alpha: 0.16814072456789708,
            colllength: 0.8774102155900628,
            pcollision: 0.043350307094370696,
          },
          {
            alpha: 0.15973368833950224,
            colllength: 0.78,
            pcollision: 0.03853754940711463,
          },
        ],
      },
      total: 0.08396685035575266,
    },
    area: {
      type: "Feature",
      properties: {},
      geometry: {
        type: "Polygon",
        coordinates: [
          [
            [43.5, 43.5],
            [43.5, 43.5],
            [43.5, 43.5],
            [43.5, 43.5],
          ],
        ],
      },
    } as Feature<Polygon>,
    allExtended: {
      collisionsAssumingAvoidance: {
        "0.96": [
          0.1394506914759957, 0.45103628819921726, 1.9020783605456482,
          1.0048995978239184, 0.17731456857381483, 0.03545285705256356,
          0.03585728066818049, 0.033463469150661077, 0.05632527751765586,
          0.795184483067773, 0.05820607955268618, 0.011133457737373677,
        ],
        "0.98": [
          0.06972534573799785, 0.22551814409960863, 0.9510391802728241,
          0.5024497989119592, 0.08865728428690742, 0.01772642852628178,
          0.017928640334090244, 0.016731734575330538, 0.02816263875882793,
          0.3975922415338865, 0.02910303977634309, 0.0055667288686868386,
        ],
        "0.99": [
          0.034862672868998926, 0.11275907204980432, 0.47551959013641204,
          0.2512248994559796, 0.04432864214345371, 0.00886321426314089,
          0.008964320167045122, 0.008365867287665269, 0.014081319379413966,
          0.19879612076694325, 0.014551519888171546, 0.0027833644343434193,
        ],
        "0.995": [
          0.017431336434499463, 0.05637953602490216, 0.23775979506820602,
          0.1256124497279898, 0.022164321071726854, 0.004431607131570445,
          0.004482160083522561, 0.0041829336438326346, 0.007040659689706983,
          0.09939806038347163, 0.007275759944085773, 0.0013916822171717096,
        ],
      },
      collisionsAssumingAvoidanceTotals: {
        "0.96": 4.700402411365488,
        "0.98": 2.350201205682744,
        "0.99": 1.175100602841372,
        "0.995": 0.587550301420686,
      },
      potentialCollisionsPerMonth: [
        3.4862672868998894, 11.275907204980422, 47.55195901364116,
        25.122489945597938, 4.432864214345367, 0.8863214263140883,
        0.8964320167045113, 0.8365867287665262, 1.4081319379413952,
        19.879612076694308, 1.4551519888171534, 0.27833644343434166,
      ],
      potentialCollisionsTotal: 117.51006028413708,
      potentialTransitsPerMonth: [
        54.43350258763384, 165.05488002345496, 670.8990610676885,
        387.09356511251906, 74.15718768555357, 15.491137493350575,
        15.213709929653074, 13.995222064239185, 20.612004324712395,
        280.476627110527, 21.30027611649932, 4.178710976495403,
      ],
      potentialTransitsTotal: 1722.9058844923272,
      fluxFactorsPerMonth: [
        282.46768584930896, 856.5068897284658, 3481.4460986259646,
        2008.715558372541, 384.81832325428775, 80.3869960760945,
        78.94736206058569, 72.62435451528184, 106.96032563666309,
        1455.4562912276842, 110.53192274174405, 21.68427095911175,
      ],
      nightHoursPerMonth: [
        454.2804136111111, 379.1678941666666, 375.5606155555555,
        318.54929444444446, 289.2253205555556, 259.3225027777778,
        276.7389977777778, 310.6102269444444, 343.2523091666667,
        400.77752000000004, 427.6474936111111, 464.3991147222222,
      ],
      dayHoursPerMonth: [
        289.71958638888884, 292.8321058333333, 368.4393844444445,
        401.4507055555556, 454.7746794444444, 460.6774972222222,
        467.2610022222222, 433.38977305555557, 376.74769083333325, 343.22248,
        292.35250638888886, 279.60088527777765,
      ],
    },
    allSingle: {
      collisionsAssumingAvoidance: {
        "0.96": [
          0.12807677830344139, 0.41424875042976744, 1.7469405559836342,
          0.922937718310747, 0.16285239211673605, 0.03256124200521724,
          0.03293267991785722, 0.030734113071149736, 0.051731260742800926,
          0.7303274416946064, 0.05345866031840436, 0.01022538779326021,
        ],
        "0.98": [
          0.06403838915172069, 0.20712437521488372, 0.8734702779918171,
          0.4614688591553735, 0.08142619605836802, 0.01628062100260862,
          0.01646633995892861, 0.015367056535574868, 0.025865630371400463,
          0.3651637208473032, 0.02672933015920218, 0.005112693896630105,
        ],
        "0.99": [
          0.032019194575860346, 0.10356218760744186, 0.43673513899590855,
          0.23073442957768675, 0.04071309802918401, 0.00814031050130431,
          0.008233169979464305, 0.007683528267787434, 0.012932815185700232,
          0.1825818604236516, 0.01336466507960109, 0.0025563469483150525,
        ],
        "0.995": [
          0.016009597287930173, 0.05178109380372093, 0.21836756949795427,
          0.11536721478884338, 0.020356549014592006, 0.004070155250652155,
          0.0041165849897321525, 0.003841764133893717, 0.006466407592850116,
          0.0912909302118258, 0.006682332539800545, 0.0012781734741575262,
        ],
      },
      collisionsAssumingAvoidanceTotals: {
        "0.96": 4.317026980687621,
        "0.98": 2.1585134903438106,
        "0.99": 1.0792567451719053,
        "0.995": 0.5396283725859526,
      },
      potentialCollisionsPerMonth: [
        3.2019194575860315, 10.356218760744177, 43.673513899590816,
        23.073442957768656, 4.071309802918398, 0.8140310501304303,
        0.8233169979464298, 0.7683528267787427, 1.293281518570022,
        18.258186042365143, 1.3364665079601077, 0.255634694831505,
      ],
      potentialCollisionsTotal: 107.92567451719044,
      potentialTransitsPerMonth: [
        50.84418345287561, 154.17124015112384, 626.6602977526736,
        361.56880050705735, 69.26729818577179, 14.46965929369701,
        14.210525170905424, 13.072383812750731, 19.252858614599354,
        261.98213242098313, 19.895746093513928, 3.903168772640115,
      ],
      potentialTransitsTotal: 1609.2982942285919,
      fluxFactorsPerMonth: [
        282.46768584930896, 856.5068897284658, 3481.4460986259646,
        2008.715558372541, 384.81832325428775, 80.3869960760945,
        78.94736206058569, 72.62435451528184, 106.96032563666309,
        1455.4562912276842, 110.53192274174405, 21.68427095911175,
      ],
      nightHoursPerMonth: [
        454.2804136111111, 379.1678941666666, 375.5606155555555,
        318.54929444444446, 289.2253205555556, 259.3225027777778,
        276.7389977777778, 310.6102269444444, 343.2523091666667,
        400.77752000000004, 427.6474936111111, 464.3991147222222,
      ],
      dayHoursPerMonth: [
        289.71958638888884, 292.8321058333333, 368.4393844444445,
        401.4507055555556, 454.7746794444444, 460.6774972222222,
        467.2610022222222, 433.38977305555557, 376.74769083333325, 343.22248,
        292.35250638888886, 279.60088527777765,
      ],
    },
  },
};

test("Vulnerability parsing unit test", () => {
  const parsed = mapVulnerabilityAnalysisResult(testAnalysisResult);
  expect(parsed).toHaveLength(1);
  expect(parsed[0]?.polygon).toEqual(testAnalysisResult[0].area);
  expect(parsed[0].data).toEqual(testAnalysisResult[0]);
  expect([
    ...Object.values(
      testAnalysisResult[0].allExtended.collisionsAssumingAvoidanceTotals
    ),
    ...Object.values(
      testAnalysisResult[0].allSingle.collisionsAssumingAvoidanceTotals
    ),
  ]).toContain(parsed[0].vulnerability);
});
